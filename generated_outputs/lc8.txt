class Solution:
    def maxPathSum(self, root: Optional[TreeNode]) -> int:
        max_sum = float('-inf')
        self.traverse(root, max_sum)
        return max_sum

    def traverse(self, node, max_sum):
        if not node:
            return 0
        left = self.traverse(node.left, max_sum)
        right = self.traverse(node.right, max_sum)
        if left < 0:
            left = 0
        if right < 0:
            right = 0
        max_sum = max(max_sum, left + right + node.val)
        return max(left, right) + node.val
